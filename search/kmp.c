#include <stdio.h>
#include <string.h>

int main()
{
    const int Nmax = 10000;
    const int Mmax = 100;
    
    int i, j, k, M, N;
    
    char s[Nmax]; /* Последовательность */
    char p[Mmax]; /* Образец для поиска */
    int d[Mmax]; /* Таблица сдвигов */
    
    gets(s); /* Чтение последовательности */
    N = strlen(s);
    
    while(1)
    {
        putchar(10);
        printf(">_");
        
        gets(p); /* Чтение образца */
        M = strlen(p);
        
        if(M == 0)
            return 0;
        
        j = 0;
        k = -1;
        d[0] = -1; /* Не было совпадений */
        
        while(j<(M-1)) /* Построение таблицы - тот же конец */
        {
            while((k >= 0) && (p[j] != p[k])) /* верхний ряд k=1 и цикл не в следующем, d[0] сдвига обратно (-1) */
                k = d[k]; /* Попытка спуска в образце */
            
            k++;
            j++;
            if(p[j] == p[k])
                d[j] = d[k];
            else
                d[j] = k;
        } /* Таблица построена тем же методом КМП */
        
        /* Начало поиска */
        i = 0;
        j = 0;
        while((j < M) && (i < N))
        {
            putchar(10);
            for(k = 0; k <= i; k++)
                printf("%c",s[k]);
        }
    }
}

// ============ СЛОЖНОСТЬ ============
// Построение таблицы: O(m) где m - длина образца
// Поиск: O(n) где n - длина текста
// Общая сложность: O(n + m)
// Память: O(m) - таблица сдвигов
// КМП не возвращается назад в тексте - линейное время!

// ============ ПРИМЕР ИСПОЛЬЗОВАНИЯ ============

/*
Алгоритм Кнута-Морриса-Пратта (KMP)

Идея: использовать информацию о предыдущих сравнениях для избежания повторных проверок

Пример поиска "ABABC" в "ABABDABACDABABCABAB":

Таблица d для образца "ABABC":
  A  B  A  B  C
 -1  0 -1  0  2

Процесс:
1. Строим таблицу d[] (префикс-функция)
2. Ищем вхождения, используя таблицу для "умных" сдвигов

Тест 1: Найти "abc" в "abcabcabc"
Найдено на позициях: 0, 3, 6

Тест 2: Найти "pattern" в "this is a pattern matching pattern"
Найдено на позициях: 10, 28

Тест 3: Образца нет в тексте
Результат: не найдено
*/

