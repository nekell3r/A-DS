/*
 * БЫСТРАЯ СОРТИРОВКА ХОАРА (РЕКУРСИВНАЯ ВЕРСИЯ)
 * =============================================
 * 
 * ИДЕЯ:
 * 1. Выбираем опорный элемент (обычно средний)
 * 2. Разделяем массив на две части:
 *    - слева: элементы МЕНЬШЕ опорного
 *    - справа: элементы БОЛЬШЕ опорного
 * 3. Рекурсивно сортируем обе части
 * 
 * КАК ПИСАТЬ:
 * 1. Функция partition():
 *    - Берём опорный элемент (средний)
 *    - Два указателя: left и right
 *    - Двигаем указатели навстречу, меняя элементы
 *    - Возвращаем точку разделения
 * 
 * 2. Функция quickSort():
 *    - Базовый случай: массив из 0-1 элементов
 *    - Разделяем массив через partition()
 *    - Рекурсивно сортируем обе части
 */

#include <stdio.h>

// Обмен двух элементов местами
void swap(int* a, int* b) {
    int temp = *a;
    *a = *b;
    *b = temp;
}

// Разделение массива на две части относительно опорного элемента
// Возвращает позицию разделения
int partition(int arr[], int left, int right) {
    // Выбираем опорный элемент (средний элемент диапазона)
    int pivot = arr[(left + right) / 2];
    
    // Пока указатели не встретились
    while (left < right) {
        // Двигаем левый указатель вправо, пока элементы меньше опорного
        while (arr[left] < pivot) {
            left++;
        }
        
        // Двигаем правый указатель влево, пока элементы больше опорного
        while (arr[right] > pivot) {
            right--;
        }
        
        // Если указатели встретились или пересеклись - пропускаем swap
        if (left >= right) {
            continue;
        }
        
        // Меняем элементы местами и сдвигаем оба указателя
        swap(&arr[left], &arr[right]);
        left++;
        right--;
    }
    
    // Возвращаем позицию разделения
    return right;
}

// Рекурсивная быстрая сортировка Хоара
// arr - массив для сортировки, left - левая граница, right - правая граница
void quickSort(int arr[], int left, int right) {
    // Базовый случай: если диапазон пустой или из одного элемента
    if (left >= right) {
        return;
    }
    
    // Разделяем массив на две части
    int m = partition(arr, left, right);
    
    // Рекурсивно сортируем левую часть [left, m]
    quickSort(arr, left, m);
    
    // Рекурсивно сортируем правую часть [m+1, right]
    quickSort(arr, m + 1, right);
}

// ============ СЛОЖНОСТЬ ============
// Время: O(n log n) в среднем, O(n²) в худшем случае
// Память: O(log n) - стек рекурсии

// ============ ПРИМЕР ИСПОЛЬЗОВАНИЯ ============

/*
#include <stdio.h>

int main() {
    printf("=== Быстрая сортировка Хоара (рекурсивная) ===\n\n");
    
    // Тест 1: Обычный массив
    int arr1[] = {5, 2, 9, 1, 7, 6, 3};
    int n1 = sizeof(arr1) / sizeof(arr1[0]);
    
    printf("Тест 1: Обычный массив\n");
    printf("До:    ");
    for (int i = 0; i < n1; i++)
        printf("%d ", arr1[i]);
    printf("\n");
    
    quickSort(arr1, 0, n1 - 1);
    
    printf("После: ");
    for (int i = 0; i < n1; i++)
        printf("%d ", arr1[i]);
    printf("\n\n");
    
    // Тест 2: Уже отсортированный
    int arr2[] = {1, 2, 3, 4, 5};
    int n2 = sizeof(arr2) / sizeof(arr2[0]);
    
    printf("Тест 2: Уже отсортированный\n");
    printf("До:    ");
    for (int i = 0; i < n2; i++)
        printf("%d ", arr2[i]);
    printf("\n");
    
    quickSort(arr2, 0, n2 - 1);
    
    printf("После: ");
    for (int i = 0; i < n2; i++)
        printf("%d ", arr2[i]);
    printf("\n\n");
    
    // Тест 3: Обратный порядок
    int arr3[] = {9, 7, 5, 3, 1};
    int n3 = sizeof(arr3) / sizeof(arr3[0]);
    
    printf("Тест 3: Обратный порядок\n");
    printf("До:    ");
    for (int i = 0; i < n3; i++)
        printf("%d ", arr3[i]);
    printf("\n");
    
    quickSort(arr3, 0, n3 - 1);
    
    printf("После: ");
    for (int i = 0; i < n3; i++)
        printf("%d ", arr3[i]);
    printf("\n\n");
    
    // Тест 4: Повторяющиеся элементы
    int arr4[] = {3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5};
    int n4 = sizeof(arr4) / sizeof(arr4[0]);
    
    printf("Тест 4: Повторяющиеся элементы\n");
    printf("До:    ");
    for (int i = 0; i < n4; i++)
        printf("%d ", arr4[i]);
    printf("\n");
    
    quickSort(arr4, 0, n4 - 1);
    
    printf("После: ");
    for (int i = 0; i < n4; i++)
        printf("%d ", arr4[i]);
    printf("\n\n");
    
    return 0;
}
*/
